{% extends "layout_base.html" %}
{% load markup %}
{% load avatar_tags %}
{% load static from staticfiles %}

{% block title %}Workbench: {{ project.name }}{% endblock title %}

{% block breadcrumbs %}
<ul class="breadcrumb">
    <li><a href="{% url 'index' %}">Home</a> <span class="divider">/</span></li>
    <li><a href="{% url 'project_list' %}">Project List</a> <span class="divider">/</span></li>
    <li class="active">Workbench</li>
</ul>
{% endblock breadcrumbs %}

{% block body %}

    <div class="row">
        <form name="input" action="{% url 'project' id=project.id %}" method="post">{% csrf_token %}
        <div class="span8">
            <h1>{{ project.name }}{% if project.version %} (v.{{project.version}}){% endif %}</h1>
            <p>Watched by {{ project.watched_by.all|length }}!
            
            {% if user.student not in project.watched_by.all %}
            <button type="submit" class="btn btn-mini" name="watch" value="true">Watch this project</button>
            {% else %}
            <button type="submit" class="btn btn-mini" name="watch" value="false">Stop watching this project</button>
            {% endif %}
            
            </p>
            <div>

<div id="assembly-editor" style="width: 100%; height: 30em;"></div>
<textarea id="assembly-text" class="input-block-level code-input" rows="20" name="code" {% if not can_edit %}disabled{% endif %} wrap="soft">{{ project.code }}</textarea>
            </div>
            
            <p>
            <select name="pattern">
            {% if project.pattern %}
                <option value="{{project.pattern.name}}">Current sprite sheet: {{project.pattern.name}}</option>
            {% endif %}
            {% for p in patterns %}
                <option value="{{p.name}}">Sprite sheet: {{p.name}}</option>
            {% endfor %}
            </select>
            </p>
            
            <div class="well">
              {% include "asm_cheatsheet.html" %}
            </div>
        </div>
        
        <div class="span4">
    
        
            <div id="emulator"></div>
    
            <div>
            <button class="btn" type="submit" name="assemble" value="assemble">Assemble</button>
            <button class="btn" type="submit" name="download" value="download">Download</button>
            {% if user.student == project.owner %}
            <button class="btn btn-success" type="button" data-toggle="modal" data-target="#publish">Publish</button>
            {% endif %}
            </div>
        
            <hr />
            <div class="well">
                <h4>Team</h4>
                <table class="table table-condensed">
                <tr><td><img src="{% avatar_url project.owner.user 24 %}&d=retro" alt="" title="" />
                        <a href="{% url 'profile' username=project.owner.username %}">{{ project.owner.username }}</a></td></tr>
                {% for t in project.team.all %}
                <tr><td><img src="{% avatar_url t.user 24 %}&d=retro" alt="" title="" />
                        <a href="{% url 'profile' username=t.username %}">{{ t.username }}</a></td></tr>
                {% endfor %}
                </table>
    
                {% if user.student == project.owner %}
                <div class="form-inline">            
                <p>
                    <input type="text" name="username" class="input input-small" placeholder="username"  />
                    <button type="submit" class="btn btn-success btn-mini" name="adduser" value="adduser"><i class="icon-plus-sign icon-white"></i></button>
                    <button type="submit" class="btn btn-danger btn-mini" name="removeuser" value="removeuser"><i class="icon-minus-sign icon-white"></i></button>
                </p>
                </div>
                
                <div>
                <p>
<button class="btn {% if not project.is_public %}disabled{% endif %}" type="submit" name="public" value="no">Private</button>
<button class="btn {% if project.is_public and not project.help_wanted %}disabled{% endif %}" type="submit" name="public" value="yes">Public</button>
<button class="btn {% if project.help_wanted %}disabled{% endif %}" type="submit" name="public" value="help">Help Wanted</button>
                </p>
                </div>
                {% endif %}
            </div>
        </div>
      
{% if user.student == project.owner %}  
<div id="publish" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="publishLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

    <h3 id="publishLabel">Publish Project</h3>
    </div>
    <div class="modal-body">
    <p>
    When you click publish, this game will be made available to the world through
    the <a href="{% url 'arcade' %}">game arcade</a>. Please provide a short
    description about how to play your game, and share the link with your friends
    when it's up and running!
    </p>
    
    <textarea class="input-block-level" rows="10" type="text" name="description"></textarea>
    </div>
    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
    <button class="btn btn-success" type="submit" name="publish" value="publish">Publish!</button>
{% endif %}
</div>
</div>
        </form>
    </div>



{% endblock body %}


{% block scripts %}
    {% include "nes.html" %}
    {% include "ace.html" %}
{% endblock scripts %}

