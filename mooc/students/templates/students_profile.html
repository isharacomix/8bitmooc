{% extends "layout_base.html" %}
{% load static %}
{% load gravatar %}
{% load creole %}
{% load bootstrap_toolkit %}

{% block title %}{{ student.username }}'s Profile{% endblock title %}

{% block body %}

    <div class="row">
        <div class="span3">
            <div>
                <p><img class="gravatar" alt="{{ student.username }}'s avatar" src="{% gravatar_for_email student.email 128 %}"></p>
            </div>
            
            <div>

            {% if user == student.user %}
            <p><a href="http://gravatar.com" class="btn btn-primary">Change Avatar</a></p>
            <p><button type="button" class="btn btn-success" data-toggle="modal" data-target="#edit">Edit Profile</button></p>
        <form name="input" action="{% url 'profile' username=student.username %}" method="post">{% csrf_token %}
        
<div id="edit" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="editlabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
<h3 id="editlabel">Edit Profile</h3>
</div>
<div class="modal-body">
<p>Edit your profile here. You can leave any or all of the fields blank if you wish.</p>
                {{ form.bio|as_bootstrap }}

                {{ form.twitter|as_bootstrap }}

                {{ form.website|as_bootstrap }}
                
                {{ form.email|as_bootstrap }}
</div>
<div class="modal-footer">
<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
<button class="btn btn-primary" type="submit" name="editprofile" value="editprofile">Save Changes</button>
</div>
</div>

        </form>
            {% elif user.is_authenticated %}
        <p><form name="input" action="{% url 'profile' username=student.username %}" method="post">{% csrf_token %}
                {% if student not in user.student.friends.all %}
                <button class="btn btn-success" type="submit" name="friend" value="friend">Add Friend</button>
                {% else %}
                <button class="btn btn-success" type="submit" name="unfriend" value="unfriend">Remove Friend</button>
                {% endif %}
                
                {% if student not in user.student.blocked.all %}
                <button class="btn btn-danger" type="submit" name="block" value="block">Block</button>
                {% else %}
                <button class="btn btn-danger" type="submit" name="unblock" value="unblock">Unblock</button>
                {% endif %}
        </form></p>
            {% endif %}
            </div>
            
            {% if student.website %}
            <div>
            <p><i class="icon-globe"></i> <a href="{{ student.website }}">{{ student.website }}</a></p>
            </div>
            {% endif %}
            
            {% if student.display_email %}
            <div>
            <p><i class="icon-envelope"></i> {{ student.email }}</p>
            </div>
            {% endif %}
            
            {% if student.twitter %}
            <div>
            <p><i class="icon-comment"></i> <a href="http://twitter.com/{{ student.twitter }}">@{{ student.twitter }}</a></p>
            </div>
            {% endif %}
            
        </div>
        
        <div class="span9">
            <h2>{{ student.username }} ({{ student.score }} points)</h2>
            
            <div>
            {{ student.bio|creole }}
            </div>
            
            <h3>Completed Stages</h3>
            <div>
              <ul class="thumbnails">
                {% for s in student.stage_set.all %}
                  <li class="span2">
                  <div class="thumbnail">
                  <a href="#" class="thumbnail">
                  <img src="{% get_static_prefix %}img/{{s.graphic}}.png" alt="World {{ s.world.shortname }}-{{ s.shortname }}" title="World {{ s.world.shortname }}-{{ s.shortname }}" />
                  </a>
                  </div>
                  </li>
                {% endfor %}
              </ul>
            </div>
            
            <h3>Achievements</h3>
            <div>
              <ul class="thumbnails">
                {% for a in student.achievement_set.all %}
                  <li class="span2">
                  <div class="thumbnail">
                  <a href="#" class="thumbnail">
                  <img src="{% get_static_prefix %}img/{{a.graphic}}.png" alt="{{a.name}}" title="{{a.name}}" />
                  </a>
                  </div>
                  </li>
                {% endfor %}
              </ul>
            </div>
            
            <h3>Game Library</h3>
            <div>
            <ul>
            {% for g in games %}
                <li><a href="{% url 'library' username=student.username gamename=g.name %}">{{ g.name }}</a></li>
            {% endfor %}
            </ul>
            </div>
        </div>
    </div>

{% endblock body %}

{% block scripts %}
    {% if autoshow %}
        <script type="text/javascript" charset="utf-8">
        $('#edit').modal('show');
        </script>
    {% endif %}
{% endblock scripts %}

